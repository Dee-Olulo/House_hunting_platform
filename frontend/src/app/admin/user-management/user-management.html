<!-- user-management.component.html -->
<div class="user-management">
  <div class="page-header">
    <div class="header-content">
      <h1>ğŸ‘¥ User Management</h1>
      <p>Manage all users across the platform</p>
    </div>
    <button class="back-btn" (click)="router.navigate(['/admin/dashboard'])">
      â† Back to Dashboard
    </button>
  </div>

  <!-- Success/Error Messages -->
  <div *ngIf="successMessage" class="success-alert">
    âœ… {{ successMessage }}
  </div>

  <div *ngIf="errorMessage" class="error-alert">
    âŒ {{ errorMessage }}
  </div>

  <!-- Filters & Search -->
  <div class="filters-section">
    <div class="search-box">
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (keyup.enter)="onSearch()"
        placeholder="Search by email..."
        class="search-input"
      />
      <button class="search-btn" (click)="onSearch()">ğŸ” Search</button>
      <button *ngIf="searchQuery" class="clear-btn" (click)="clearSearch()">
        âœ•
      </button>
    </div>

    <div class="filter-controls">
      <select [(ngModel)]="selectedRole" (change)="onFilterChange()" class="filter-select">
        <option value="">All Roles</option>
        <option value="tenant">Tenants</option>
        <option value="landlord">Landlords</option>
        <option value="admin">Admins</option>
      </select>

      <select [(ngModel)]="sortBy" (change)="onFilterChange()" class="filter-select">
        <option value="newest">Newest First</option>
        <option value="oldest">Oldest First</option>
      </select>

      <button class="refresh-btn" (click)="loadUsers()">
        ğŸ”„ Refresh
      </button>
    </div>
  </div>

  <!-- Stats Summary -->
  <div class="stats-summary">
    <div class="stat-item">
      <span class="stat-label">Total Users:</span>
      <span class="stat-value">{{ totalUsers }}</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Showing:</span>
      <span class="stat-value">{{ users.length }} users</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Page:</span>
      <span class="stat-value">{{ currentPage }} / {{ totalPages }}</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Loading users...</p>
  </div>

  <!-- Users Table -->
  <div *ngIf="!isLoading && users.length > 0" class="users-table-container">
    <table class="users-table">
      <thead>
        <tr>
          <th>Email</th>
          <th>Role</th>
          <th>Joined</th>
          <th>Properties</th>
          <th>Bookings</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users" [class.suspended-row]="user.is_suspended">
          <td class="email-cell">{{ user.email }}</td>
          <td>
            <span class="role-badge" [ngClass]="getRoleBadgeClass(user.role)">
              {{ user.role }}
            </span>
          </td>
          <td>{{ user.created_at | date:'MMM d, y' }}</td>
          <td>{{ user.properties_count || 0 }}</td>
          <td>{{ user.bookings_count || 0 }}</td>
          <td>
            <span class="status-badge" [class.suspended]="user.is_suspended">
              {{ user.is_suspended ? 'Suspended' : 'Active' }}
            </span>
          </td>
          <td class="actions-cell">
            <button class="action-btn view" (click)="viewUserDetails(user._id)" title="View Details">
              ğŸ‘ï¸
            </button>
            <button
              *ngIf="!user.is_suspended"
              class="action-btn suspend"
              (click)="openSuspendModal(user)"
              title="Suspend User"
            >
              ğŸš«
            </button>
            <button
              *ngIf="user.is_suspended"
              class="action-btn activate"
              (click)="activateUser(user)"
              title="Activate User"
            >
              âœ…
            </button>
            <button
              *ngIf="user.role !== 'admin'"
              class="action-btn delete"
              (click)="openDeleteModal(user)"
              title="Delete User"
            >
              ğŸ—‘ï¸
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- No Results -->
  <div *ngIf="!isLoading && users.length === 0" class="no-results">
    <p>ğŸ“­ No users found</p>
    <button class="clear-filters-btn" (click)="clearSearch(); selectedRole = ''; onFilterChange()">
      Clear Filters
    </button>
  </div>

  <!-- Pagination -->
  <div *ngIf="!isLoading && users.length > 0" class="pagination">
    <button
      class="page-btn"
      (click)="previousPage()"
      [disabled]="currentPage === 1"
    >
      â† Previous
    </button>
    <span class="page-info">
      Page {{ currentPage }} of {{ totalPages }}
    </span>
    <button
      class="page-btn"
      (click)="nextPage()"
      [disabled]="currentPage === totalPages"
    >
      Next â†’
    </button>
  </div>

  <!-- Suspend Modal -->
  <div *ngIf="showSuspendModal" class="modal-overlay" (click)="closeSuspendModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>Suspend User</h2>
      <p>You are about to suspend: <strong>{{ selectedUser?.email }}</strong></p>
      
      <div class="form-group">
        <label>Reason for suspension *</label>
        <textarea
          [(ngModel)]="suspendReason"
          placeholder="Enter reason for suspension..."
          rows="4"
          class="modal-textarea"
        ></textarea>
      </div>

      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeSuspendModal()">Cancel</button>
        <button
          class="confirm-btn suspend"
          (click)="confirmSuspend()"
          [disabled]="!suspendReason.trim()"
        >
          Suspend User
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div *ngIf="showDeleteModal" class="modal-overlay" (click)="closeDeleteModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>Delete User</h2>
      <p class="warning-text">
        âš ï¸ This action cannot be undone!
      </p>
      <p>
        Are you sure you want to delete <strong>{{ selectedUser?.email }}</strong>?
      </p>
      <p class="info-text">
        This will permanently delete the user and all associated data.
      </p>

      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeDeleteModal()">Cancel</button>
        <button class="confirm-btn delete" (click)="confirmDelete()">
          Delete User
        </button>
      </div>
    </div>
  </div>
</div>