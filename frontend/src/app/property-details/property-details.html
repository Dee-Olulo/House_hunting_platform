<!-- Loading State -->
<div *ngIf="isLoading" class="loading-container">
  <div class="spinner"></div>
  <p>Loading property details...</p>
</div>

<!-- Error State -->
<div *ngIf="errorMessage && !isLoading" class="error-container">
  <div class="error-icon">âš ï¸</div>
  <h3>Error Loading Property</h3>
  <p>{{ errorMessage }}</p>
  <button class="btn btn-primary" (click)="goBack()">Go Back</button>
</div>

<!-- Property Details -->
<div *ngIf="property && !isLoading" class="property-details-container">
  
  <!-- Header with Back Button -->
  <div class="details-header">
    <button class="back-btn" (click)="goBack()">
      â† Back to Properties
    </button>
    <button *ngIf="isOwner()" class="edit-btn" (click)="editProperty()">
      âœï¸ Edit Property
    </button>
  </div>

  <!-- Main Image Carousel -->
  <div class="image-carousel" *ngIf="hasImages()">
    <div class="carousel-main">
      <img [src]="getCurrentImage()" [alt]="property.title">
      
      <!-- Navigation Arrows -->
      <button class="carousel-btn prev" (click)="previousImage()" *ngIf="property.images && property.images.length > 1">
        â€¹
      </button>
      <button class="carousel-btn next" (click)="nextImage()" *ngIf="property.images && property.images.length > 1">
        â€º
      </button>
      
      <!-- Image Counter -->
      <div class="image-counter" *ngIf="property.images && property.images.length > 1">
        {{ currentImageIndex + 1 }} / {{ property.images.length }}
      </div>
    </div>
    
    <!-- Thumbnail Navigation -->
    <div class="carousel-thumbnails" *ngIf="property.images && property.images.length > 1">
      <img 
        *ngFor="let image of property.images; let i = index"
        [src]="getImageUrl(image)"
        [alt]="'Thumbnail ' + (i + 1)"
        [class.active]="i === currentImageIndex"
        (click)="selectImage(i)">
    </div>
  </div>

  <!-- Placeholder if no images -->
  <div class="no-image-placeholder" *ngIf="!hasImages()">
    <div class="placeholder-icon">ğŸ </div>
    <p>No images available</p>
  </div>
   <!-- Video Gallery -->
    <div class="property-section video-section" *ngIf="hasVideos()">
      <h2>ğŸ¥ Property Videos</h2>
      <div class="video-gallery">
        <div class="video-grid">
          <div *ngFor="let video of property.videos; let i = index" class="video-item">
            <video 
              [src]="getVideoUrl(video)" 
              controls
              preload="metadata"
              [poster]="getVideoPoster(video)"
              class="property-video"
              playsinline>
              Your browser does not support the video tag.
            </video>
            <div class="video-info">
              <span>Video {{ i + 1 }} of {{ property.videos }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  <!-- Property Information -->
  <div class="property-info">
    <div class="info-header">AC
      <div>
        <h1>{{ property.title }}</h1>
        <p class="location">
          ğŸ“ {{ property.address }}, {{ property.city }}
          <span *ngIf="distanceToProperty !== null" class="distance-badge">
            â€¢ {{ formatDistance(distanceToProperty) }} away
          </span>
        </p>
      </div>
      <div class="price-tag">
        <span class="price">KES {{ property.price.toLocaleString() }}</span>
        <span class="period">/month</span>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="property-stats">
      <div class="stat-item">
        <span class="stat-icon">ğŸ›ï¸</span>
        <span class="stat-value">{{ property.bedrooms }}</span>
        <span class="stat-label">Bedrooms</span>
      </div>
      <div class="stat-item">
        <span class="stat-icon">ğŸš¿</span>
        <span class="stat-value">{{ property.bathrooms }}</span>
        <span class="stat-label">Bathrooms</span>
      </div>
      <div class="stat-item" *ngIf="property.area_sqft">
        <span class="stat-icon">ğŸ“</span>
        <span class="stat-value">{{ property.area_sqft }}</span>
        <span class="stat-label">Sq Ft</span>
      </div>
      <div class="stat-item">
        <span class="stat-icon">ğŸ¢</span>
        <span class="stat-value">{{ property.property_type }}</span>
        <span class="stat-label">Type</span>
      </div>
    </div>

    <!-- Description -->
    <div class="property-section">
      <h2>ğŸ“ Description</h2>
      <p class="description">{{ property.description }}</p>
    </div>

    <!-- Amenities -->
    <div class="property-section" *ngIf="property.amenities && property.amenities.length > 0">
      <h2>âœ¨ Amenities</h2>
      <div class="amenities-grid">
        <div class="amenity-item" *ngFor="let amenity of property.amenities">
          <span class="amenity-icon">âœ“</span>
          <span>{{ amenity }}</span>
        </div>
      </div>
    </div>

   

    <!-- Location & Map -->
    <div class="property-section" *ngIf="property.latitude && property.longitude">
      <h2>ğŸ“ Location</h2>
      <div class="location-info">
        <p>
          <strong>Address:</strong> {{ property.address }}<br>
          <strong>City:</strong> {{ property.city }}<br>
          <strong>State:</strong> {{ property.state }}<br>
          <strong>Country:</strong> {{ property.country }}
        </p>
        <button *ngIf="distanceToProperty !== null" class="btn btn-secondary" (click)="getDirections()">
          ğŸ§­ Get Directions
        </button>
      </div>
      
      <div class="map-container">
        <app-map [height]="'400px'"></app-map>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn btn-primary btn-large" (click)="bookViewing()" *ngIf="!isOwner()">
        ğŸ“… Book a Viewing
      </button>
      <button class="btn btn-secondary btn-large" (click)="contactLandlord()" *ngIf="!isOwner()">
        ğŸ’¬ Contact Landlord
      </button>
    </div> 
    <div *ngIf="isOwner() && property.moderation_status" class="moderation-panel">
  <h3>ğŸ“‹ Moderation Status</h3>
  
  <div class="moderation-info">
    <div class="info-row">
      <span class="label">Status:</span>
      <span class="badge" [ngClass]="getModerationClass(property.moderation_status)">
        {{ getModerationLabel(property.moderation_status) }}
      </span>
    </div>
    
    <div class="info-row" *ngIf="property.moderation_score">
      <span class="label">Quality Score:</span>
      <span class="score" [ngClass]="getScoreClass(property.moderation_score)">
        {{ property.moderation_score }}/100
      </span>
    </div>
    
    <div class="info-row" *ngIf="property.moderation_notes">
      <span class="label">Notes:</span>
      <span>{{ property.moderation_notes }}</span>
    </div>
    
    <!-- Show issues if any -->
    <div *ngIf="property.moderation_issues && property.moderation_issues.length > 0" class="issues-list">
      <h4>Issues to Address:</h4>
      <ul>
        <li *ngFor="let issue of property.moderation_issues">{{ issue }}</li>
      </ul>
      
      <!-- Button to request re-moderation -->
      <button *ngIf="property.moderation_status !== 'approved'" 
              class="btn btn-primary"
              (click)="requestRemoderation()">
        ğŸ”„ Request Re-Review
      </button>
    </div>
  </div>
</div>

  </div>
</div>
 