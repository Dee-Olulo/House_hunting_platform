<!-- src/app/landlord/add-property/add-property.html -->

<div class="add-property-container">
  <div class="form-header">
    <h1>Add New Property</h1>
    <p>Fill in the details below to list your property</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>

  <form (ngSubmit)="onSubmit()" #propertyForm="ngForm">
    <!-- Basic Information -->
    <div class="form-section">
      <h2>Basic Information</h2>
      
      <div class="form-row">
        <div class="form-group">
          <label for="title">Property Title *</label>
          <input
            type="text"
            id="title"
            name="title"
            [(ngModel)]="property.title"
            required
            minlength="5"
            placeholder="e.g., Beautiful 2BR Apartment in Westlands"
            class="form-input"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group full-width">
          <label for="description">Description *</label>
          <textarea
            id="description"
            name="description"
            [(ngModel)]="property.description"
            required
            minlength="20"
            rows="4"
            placeholder="Describe your property in detail..."
            class="form-input"
          ></textarea>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="property_type">Property Type *</label>
          <select
            id="property_type"
            name="property_type"
            [(ngModel)]="property.property_type"
            required
            class="form-input"
          >
            <option value="">Select type</option>
            <option *ngFor="let type of propertyTypes" [value]="type">
              {{ type | titlecase }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="price">Monthly Rent (KES) *</label>
          <input
            type="number"
            id="price"
            name="price"
            [(ngModel)]="property.price"
            required
            min="0"
            placeholder="50000"
            class="form-input"
          />
        </div>
      </div>
    </div>

    <!-- Location Picker Component -->
    <div class="form-section">
      <app-location-picker
        [locationData]="locationData"
        (locationChange)="onLocationChange($event)"
      ></app-location-picker>
    </div>

    <!-- Property Details -->
    <div class="form-section">
      <h2>Property Details</h2>
      
      <div class="form-row">
        <div class="form-group">
          <label for="bedrooms">Bedrooms *</label>
          <input
            type="number"
            id="bedrooms"
            name="bedrooms"
            [(ngModel)]="property.bedrooms"
            required
            min="0"
            placeholder="2"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label for="bathrooms">Bathrooms *</label>
          <input
            type="number"
            id="bathrooms"
            name="bathrooms"
            [(ngModel)]="property.bathrooms"
            required
            min="0"
            step="0.5"
            placeholder="1.5"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label for="area_sqft">Area (sqft) *</label>
          <input
            type="number"
            id="area_sqft"
            name="area_sqft"
            [(ngModel)]="property.area_sqft"
            required
            min="0"
            placeholder="1000"
            class="form-input"
          />
        </div>
      </div>
    </div>

    <!-- Amenities -->
    <div class="form-section">
      <h2>Amenities</h2>
      <div class="amenities-grid">
        <div *ngFor="let amenity of availableAmenities" class="amenity-item">
          <label>
            <input
              type="checkbox"
              [checked]="isAmenitySelected(amenity)"
              (change)="toggleAmenity(amenity)"
            />
            <span>{{ amenity | titlecase }}</span>
          </label>
        </div>
      </div>
    </div>

    <!-- Images Section -->
    <div class="form-section">
      <h2>Images</h2>
      <p class="form-hint">Upload up to 20 images (max 5MB each)</p>
      
      <div class="file-upload">
        <input
          type="file"
          id="images"
          accept="image/*"
          multiple
          (change)="onImageSelect($event)"
          #fileInput
        />
        <label for="images" class="file-upload-label">
          ðŸ“· Choose Images
        </label>
      </div>

      <!-- Selected Images Preview -->
      <div *ngIf="selectedImages.length > 0" class="images-preview">
        <h3>Selected Images ({{ selectedImages.length }})</h3>
        <div class="images-grid">
          <div *ngFor="let image of selectedImagePreviews; let i = index" class="image-preview">
            <img [src]="image" alt="Preview" />
            <button type="button" (click)="removeImage(i)" class="btn-remove">Ã—</button>
          </div>
        </div>
      </div>

      <!-- Uploaded Images -->
      <div *ngIf="uploadedImageUrls.length > 0" class="images-preview">
        <h3>Uploaded Images ({{ uploadedImageUrls.length }})</h3>
        <div class="images-grid">
          <div *ngFor="let url of uploadedImageUrls; let i = index" class="image-preview">
            <img [src]="url" alt="Uploaded" />
            <button type="button" (click)="removeUploadedImage(i)" class="btn-remove">Ã—</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Videos Section (NEW) -->
    <div class="form-section">
      <h2>Videos</h2>
      <p class="form-hint">Upload up to 5 videos (max 100MB each, 5 minutes max duration)</p>
      
      <div class="file-upload">
        <input
          type="file"
          id="videos"
          accept="video/*"
          multiple
          (change)="onVideoSelect($event)"
          #videoInput
        />
        <label for="videos" class="file-upload-label">
          ðŸŽ¥ Choose Videos
        </label>
      </div>

      <!-- Selected Videos Preview -->
      <div *ngIf="selectedVideos.length > 0" class="videos-preview">
        <h3>Selected Videos ({{ selectedVideos.length }})</h3>
        <div class="videos-grid">
          <div *ngFor="let video of selectedVideos; let i = index" class="video-preview">
            <video [src]="videoPreviewUrls[i]" controls></video>
            <p class="video-name">{{ video.name }}</p>
            <button type="button" (click)="removeVideo(i)" class="btn-remove">Ã—</button>
          </div>
        </div>
      </div>

      <!-- Uploaded Videos -->
      <div *ngIf="uploadedVideoUrls.length > 0" class="videos-preview">
        <h3>Uploaded Videos ({{ uploadedVideoUrls.length }})</h3>
        <div class="videos-grid">
          <div *ngFor="let url of uploadedVideoUrls; let i = index" class="video-preview">
            <video [src]="url" controls></video>
            <button type="button" (click)="removeUploadedVideo(i)" class="btn-remove">Ã—</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" (click)="cancel()" class="btn-cancel" [disabled]="isLoading || isUploading">
        Cancel
      </button>
      <button
        type="submit"
        class="btn-submit"
        [disabled]="!propertyForm.valid || isLoading || isUploading"
      >
        <span *ngIf="!isLoading && !isUploading">Create Property</span>
        <span *ngIf="isUploading">Uploading Media...</span>
        <span *ngIf="isLoading && !isUploading">Creating Property...</span>
      </button>
    </div>
  </form>
</div>